

pipeline {
        agent any

            stages {

                stage ('Setup Config') {
                    // Setting up Pipelines and Environment
                    stages {
                        stage ('Polling Jenkinsfile') {
                            steps {
                                echo 'Reading Jenkins file and processing pipeline'
                            }
                        }

                        stage ('Git Pull') {
                            steps {
                                echo 'cloning git repository'
                                checkout scmGit(branches: [[name: '*/test']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/moosasharieff/OwlEyes']])
                            }
                        }

                        stage ('Installing Dependencies') {
                            steps {
                                echo 'installing package requirements'
                                sh 'pip3 install -r requirements.txt'
                            }
                        }

                        stage ('JIRA Updated') {
                            steps {
                                echo 'Updating JIRA Issue'
                                // command to update JIRA
                            }
                        }

                    }

                }

                stage ('Build') {
                    steps {
                        echo 'Building Docker image'
                        sh "screen -dmS new bash -c 'pytho3 manage.py runserver'"
                        //sh 'su docker'
                       // sh 'docker build -t owleyes-app .'
                        // echo 'Running Docker image'
                        // sh 'sudo docker run -it -d -p 8000:8000 owleyes-app'
                    }
                }

                stage ('Staging') {
                    // Performing tests
                    stages {
                        stage ('Unit Tests') {
                            steps {
                                echo 'Performing Unit Tests inside docker'
                                // Add test commands here
                            }
                        }
                    }

                }

                stage ('Deployment') {
                    stages {
                        stage ('Merge') {
                            steps {
                                echo 'Merging dev branch with main branch'
                                // Figure out a way to pause here and post
                                // merging of branching, deployment continues
                                // in main branch
                            }
                        }

                        stage ('Docker Build'){
                            steps {
                                echo 'Building Docker Container'
                                // add docker build container command here
                            }
                        }

                        stage ('Deploy') {
                            steps {
                                echo 'Launching Docker Container'
                                // add docker command to launch the container
                                //sh 'python3 manage.py migrate'
                                //sh 'python3 manage.py makemigrations'
                                //sh 'python3 manage.py migrate'
                                //sh 'python3 manage.py runserver'
                            }
                        }

                        stage ('Nginx Rebooted') {
                            steps {
                                echo 'Restart Nginx'
                                // add docker command to launch the container
                                // sh 'sudo systemctl restart nginx'
                            }
                       }
                    }
                }
                stage ('Monitoring') {
                    stages {
                        stage ('Slack Notification') {
                            steps {
                                echo 'Final notification sent to Slack'
                                // add commands to notify Slack from Jenkins
                            }
                        }

                    stage ('JIRA Notified') {
                        steps {
                            echo 'Updated JIRA with Status'
                            // add commands to notify JIRA from Jenkins
                        }
                    }
                }
            }
        }
    }